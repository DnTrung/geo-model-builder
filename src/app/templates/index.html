<!DOCTYPE html>

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">


    <title>Geometry Diagram Builder</title>
    <meta name="description" content="Geometry Diagram Builder">

    <script src="{{ url_for('static',filename='js/jquery-3.5.1.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/jquery-ui.min.js') }}"></script>

    <link rel="stylesheet" href="{{ url_for('static',filename='css/jquery-ui.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}" />


    <script type="text/javascript">

      window.onload = function () {
          var cm = CodeMirror.fromTextArea(document.getElementById('editor'), {
              mode: "text/x-common-lisp",
              lineNumbers: true,
              matchBrackets: true,
              autoCloseBrackets: true,
              keyMap: "emacs",
              theme: "3024-day"
          });
          cm.setSize("100%", "100%");

          function handleFileSelect(evt) {
              var files = evt.target.files; // FileList object

              // use the 1st file from the list
              f = files[0];

              var reader = new FileReader();

              // Closure to capture the file information
              reader.onload = (function(theFile) {

                  return function(e) {
                      cm.setValue(e.target.result);
                      // console.log(e.target.result);
                  };
              })(f);

              // Read in the image file as a data URL
              reader.readAsText(f);
          }

          document.getElementById('upload-problem').addEventListener('change', handleFileSelect, false);

      };

      $(document).ready(function() {
          var dImg = document.getElementById('diagram-img');
          $(document).ajaxStart(function() {
              dImg.style.opacity = "0.5";
          }).ajaxStop(function() {
              dImg.style.opacity = "1.0";
          });

          var cm = document.querySelector('.CodeMirror').CodeMirror;

          $('#solve-btn').click(function() {
              /*
              $.ajax({
                  url: "{{ url_for ('get_img') }}",
                  type: "GET",
                  // global: false,
                  success: function(response) {
                      $("#diagram-img").attr('src', '/static/img/' + response);
                  },
                  error: function(xhr) {
                      console.log(xhr)
                  }
              });
              */
              $.ajax({
                  url: "{{ url_for ('solve') }}",
                  type: "POST",
                  // global: false,
                  data: {
                      hi: cm.getValue()
                  },
                  success: function(response) {
                      console.log(response);
                      $("#diagram-img").attr('src', '/static/img/' + response + "?" + new Date().getTime());
                  },
                  error: function(err) {
                      console.log(err.responseText)
                      document.getElementById("error").innerHTML = err.responseText;
                  }
              });
          });
      });

    </script>

    <script>

    </script>



  </head>

  <body>

    <!-- CODE MIRROR -->
    <link rel="stylesheet" href="{{ url_for('static',filename='plugin/codemirror/lib/codemirror.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='plugin/codemirror/theme/3024-day.css') }}">
    <script src="{{ url_for('static',filename='plugin/codemirror/lib/codemirror.js') }}"></script>

    <script src="{{ url_for('static',filename='plugin/codemirror/addon/edit/matchbrackets.js') }}"></script>
    <script src="{{ url_for('static',filename='plugin/codemirror/addon/edit/closebrackets.js') }}"></script>
    <script src="{{ url_for('static',filename='plugin/codemirror/keymap/emacs.js') }}"></script>
    <script src="{{ url_for('static', filename='plugin/codemirror/mode/commonlisp/commonlisp.js') }}"></script>

    <!-- BOOTSTRAP -->
    <!--
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>


    <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light">
      <a class="navbar-brand" href="#">GeoBuilder</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Tutorial</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Examples</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Contact</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid p-3">
      <div class="row">
        <div class="col">
          <textarea id="editor"></textarea>
        </div>
        <div class="col">

          <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">

            <ol class="carousel-indicators">

              <li data-target="#carouselExampleControls" data-slide-to="0" class="active"></li>
              <!-- <li data-target="#carouselExampleControls" data-slide-to="1"></li> -->
            </ol>
            <div class="carousel-inner">
              <div class="carousel-item active">

                <img src="{{ url_for('static',filename='img/empty-diag.jpg') }}" class="d-block w-100" alt="Image 1" id="diagram-img">
              </div>

              <!--
              <div class="carousel-item">
                <img src="../static/img/diagram_0.png" class="d-block w-100" alt="Image 2">
              </div>
              -->
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <button type="button" id="solve-btn" class="btn btn-primary btn-lg btn-block">Build!</button>

    </div>
    <div class="container-fluid">
      <p id="error"></p>
    </div>
    <div class="container-fluid p-3">
      <p>
        <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
          Advanced Options
        </button>
      </p>
      <div class="collapse" id="collapseExample">
        <div class="card card-body">
          <form>
            <div class="custom-control custom-radio">
              <input type="radio" class="custom-control-input" id="customControlValidation2" name="radio-stacked" disabled checked>
              <label class="custom-control-label" for="customControlValidation2">Instructions</label>
            </div>
            <div class="custom-control custom-radio mb-3">
              <input type="radio" class="custom-control-input" id="customControlValidation3" name="radio-stacked" disabled>
              <label class="custom-control-label" for="customControlValidation3">Compilation</label>
            </div>
            <div class="form-group">
              <label for="example-number-input">No. of Models</label>
              <div>
                <input class="form-control" type="number" value="1" id="example-number-input" disabled>
              </div>
            </div>
            <!--
            <div class="form-group">
              <label for="point-distance">Min. Point Distance</label>
              <div>
                <input class="form-control" type="number" value="{{ FIXME default size}}" step="0.01" disabled>
              </div>
            </div>
            -->
            <div class="form-group">
              <label for="upload-problem">Upload File</label>
              <input type="file" class="form-control-file" id="upload-problem">
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <h1>About</h1>
      <p>GeoBuilder is a tool for writing and solving systems of geometric constraints for olympiad-style geometry problems. The input to GeoBuilder is a problem statement (i.e., system of geometric constraints) written in a custom domain-specific language (DSL). This DSL permits reasoning about three types of geometric objects: points, lines, and circles. GeoBuilder outputs diagrams (i.e., models for the constraint system) that satisfy the problem statement. The user can specify how many such models they would like to generate, and can subsequently download information about these models for inspection. GeoBuilder is also made available as a command-line interface for integration with other tools.</p>
      <p>This work was motivated by an ongoing effort to complete the <a href="">IMO Grand Challenge</a> -- an effort led by Daniel Selsam to build an AI that can win a gold medal at the International Mathematical Olympiad (IMO). The models generated by GeoBuilder are intended to guide solvers for such geometry problems, though it may have uses in other domains (e.g., education, computer-aided design). For technical details, please refer to the <a href="">arXiv paper</a>.</p>
    </div>

    <div class="container-fluid">
      <h1>Tutorial</h1>
      <p>The following tutorial describes the DSL in which users write GeoBuilder problem statements for model generation. This DSL can broadly be summarized in two parts:</p>
      <ol>
        <li>A set of commands to construct a numerical optimization problem to solve for parameterized points, lines, and circles</li>
        <li>A set of functions and predicates to define points/lines/circles/numerical values and relationships between them to serve as arguments to the aforementioned commands</li>
      </ol>
      <p>All commands, predicates, and function symbols follow Lisp-style <a href="https://en.wikipedia.org/wiki/S-expression">s-expression</a> format.</p>

      <h2>Preliminaries</h2>
      <p>This tutorial makes common use of the following notation:</p>
      <ul>
        <li><code>NAME</code>: A string value that refers to the name of a geometric object (i.e., point, line, or circle). Refers to the name of an object of any type unless specified (e.g., <code>POINT-NAME</code>)</li>
        <li><code>VAL</code>: The value of a geometric object or numerical value. A value is denoted either by a <code>NAME</code> or a function (see <a href="">Functions and Predicates</a>). Like <code>NAME</code>, <code>VAL</code> is used in this tutorial to refer to a value of any type unless specified (e.g., <code>LINE-VAL</code>). Note that names cannot be given to numerical values</li>
      </ul>
      <p><code>PRED</code> and <code>FUNC</code> are used as shorthand for <code>PREDICATE</code> and <code>FUNCTION</code>, respectively</p>.

      <h2>Commands</h2>
      <p>GeoBuilder generates models by translating a geometric constraint problem into a numerical optimization problem and solving it with off-the-shelf optimizers. The following (FIXME #) commands reflect this, and comprise the primary grammar of the DSL</p>
      <!--

          LOOK AT JESSES PROCESS_COMMAND

           Compute: (compute NAME VAL). Introduces a geometric object called NAME and assigns it value VAL. VAL cannot be a string (as duplicate objects are not allowed), and the type of NAME and VAL must be the same (e.g., (compute POINT-NAME POINT-VAL) is accepted while (compute POINT-NAME CIRCLE-VAL) is not).

           Param: (param NAME TYPE OPTIONAL-REPARAM). Introduces a geometric object that is parameterized either by it's types default parameterization or the reparameterization. Certain reparameterizations are allowed for each type (see below). See the default parameterizations below.

           Note: You cannot introduce the same object twice. (examples of allowed/not-allowed. allowed is compute one thing, compute another, or param another. Not-allowed is compute one thing then param it)

           Assert: (assert PRED). Introduces an additional constraint on the system. All NAMEs used when constructing a PRED for assert have to refer to geometric objects that have already been introduced. (show allowed and not allowed). Also show NOT example.

           Confirm: (confirm PRED). Introduces a constraint to filter final solutions, but a constraint that is not optimized over.

           Note: Confirm may only be useful to people interested in automated theorem proving for problems of the form "Given a system that satisfies X constraints, prove Y". They may want to have X constraints and not optimize Y, but be assured Y holds in the model.

           Note to Ryan: In prelminaries, state the PREDICATE is often short-handed to PRED and FUNCTION is often short-handed to FUNC.

      -->

      <h2>Functions and Predicates</h2>
      <p>Per the above section, GeoBuilder operates on a set of commands that accept points, lines, circles, numerical values, and predicates as arguments. The following functions and predicates are the operations by which a user can define such arguments for use in the above commands</p>
    </div>

    <div class="container-fluid">
      <h1>Examples</h1>
      <p>The following examples are adapted from <a href="">previous IMO problems</a>, as well as problems found in <a href="">Evan Chen&#39;s "Euclidean Geometry in Mathematical Olympiads" (EGMO)</a>.</p>
    </div>

    <div class="container-fluid">
      <h1>Contact</h1>
      <p>GeoBuilder is extensible in nature. Should you have any feature suggestions (e.g., new function symbols or predicates) or encounter any bugs, please open an issue on <a href="">Github</a>. For other inquiries, please contact <a href="mailto:ryankrue@umich.edu">ryankrue@umich.edu</a></p>
    </div>

  </body>
</html>
