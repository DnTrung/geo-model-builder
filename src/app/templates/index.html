<!DOCTYPE html>

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">


    <title>Geometry Diagram Builder</title>
    <meta name="description" content="Geometry Diagram Builder">

    <script src="{{ url_for('static',filename='js/jquery-3.5.1.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/jquery-ui.min.js') }}"></script>

    <link rel="stylesheet" href="{{ url_for('static',filename='css/jquery-ui.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}" />


    <script type="text/javascript">

      window.onload = function () {
          var cm = CodeMirror.fromTextArea(document.getElementById('editor'), {
              mode: "text/x-common-lisp",
              lineNumbers: true,
              matchBrackets: true,
              autoCloseBrackets: true,
              keyMap: "emacs",
              theme: "3024-day"
          });
          cm.setSize("100%", "100%");
      };

      $(document).ready(function() {
          var dImg = document.getElementById('diagram-img');
          $(document).ajaxStart(function() {
              dImg.style.opacity = "0.5";
          }).ajaxStop(function() {
              dImg.style.opacity = "1.0";
          });

          var cm = document.querySelector('.CodeMirror').CodeMirror;

          $('#solve-btn').click(function() {
              /*
              $.ajax({
                  url: "{{ url_for ('get_img') }}",
                  type: "GET",
                  // global: false,
                  success: function(response) {
                      $("#diagram-img").attr('src', '/static/img/' + response);
                  },
                  error: function(xhr) {
                      console.log(xhr)
                  }
              });
              */
              $.ajax({
                  url: "{{ url_for ('solve') }}",
                  type: "POST",
                  // global: false,
                  data: {
                      hi: cm.getValue()
                  },
                  success: function(response) {
                      console.log(response);
                      $("#diagram-img").attr('src', '/static/img/' + response + "?" + new Date().getTime());
                  },
                  error: function(err) {
                      console.log(err.responseText)
                      document.getElementById("error").innerHTML = err.responseText;
                  }
              });
          });
      });

    </script>

  </head>

  <body>

    <!-- CODE MIRROR -->
    <link rel="stylesheet" href="{{ url_for('static',filename='plugin/codemirror/lib/codemirror.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='plugin/codemirror/theme/3024-day.css') }}">
    <script src="{{ url_for('static',filename='plugin/codemirror/lib/codemirror.js') }}"></script>

    <script src="{{ url_for('static',filename='plugin/codemirror/addon/edit/matchbrackets.js') }}"></script>
    <script src="{{ url_for('static',filename='plugin/codemirror/addon/edit/closebrackets.js') }}"></script>
    <script src="{{ url_for('static',filename='plugin/codemirror/keymap/emacs.js') }}"></script>
    <script src="{{ url_for('static', filename='plugin/codemirror/mode/commonlisp/commonlisp.js') }}"></script>

    <!-- BOOTSTRAP -->
    <!--
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>


    <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light">
      <a class="navbar-brand" href="#">GeoBuilder</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Tutorial</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Paper</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid p-3">
      <div class="row">
        <div class="col">
          <textarea id="editor"></textarea>
        </div>
        <div class="col">

          <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">

            <ol class="carousel-indicators">

              <li data-target="#carouselExampleControls" data-slide-to="0" class="active"></li>
              <!-- <li data-target="#carouselExampleControls" data-slide-to="1"></li> -->
            </ol>
            <div class="carousel-inner">
              <div class="carousel-item active">

                <img src="{{ url_for('static',filename='img/empty-diag.jpg') }}" class="d-block w-100" alt="Image 1" id="diagram-img">
              </div>

              <!--
              <div class="carousel-item">
                <img src="../static/img/diagram_0.png" class="d-block w-100" alt="Image 2">
              </div>
              -->
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <button type="button" id="solve-btn" class="btn btn-primary btn-lg btn-block">Build!</button>

    </div>
    <div class="container-fluid">
      <p id="error"></p>
    </div>
    <div class="container-fluid p-3">
      <p>
        <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
          Advanced Options
        </button>
      </p>
      <div class="collapse" id="collapseExample">
        <div class="card card-body">
          <form>
            <div class="custom-control custom-radio">
              <input type="radio" class="custom-control-input" id="customControlValidation2" name="radio-stacked" disabled checked>
              <label class="custom-control-label" for="customControlValidation2">Instructions</label>
            </div>
            <div class="custom-control custom-radio mb-3">
              <input type="radio" class="custom-control-input" id="customControlValidation3" name="radio-stacked" disabled>
              <label class="custom-control-label" for="customControlValidation3">Compilation</label>
            </div>
            <div class="form-group">
              <label for="example-number-input">No. of Models</label>
              <div>
                <input class="form-control" type="number" value="1" id="example-number-input" disabled>
              </div>
            </div>
            <div class="form-group">
              <label for="exampleFormControlFile1">Upload File</label>
              <input type="file" class="form-control-file" id="exampleFormControlFile1" disabled>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <h1>About</h1>
      <p>GeoBuilder is a tool for writing and solving systems of geometric constraints for olympiad-style geometry problems.</p>
    </div>

  </body>
</html>
